# Guide to configuring Keebio Iris keyboard with Ibby's keymap and other optional features

Overview:

- The keymap can be viewed in the accompanying PDF.
- The keymap `.json` file was generated by [QMK Configurator](https://config.qmk.fm/).
- Layer 0 in the keymap is configured for Mac.
- Layer 1 in the keymap is configured for PC.
- Layer 2 in the keymap is a raise/function layer.
- Layer 3 in the keymap is for audio, screen, and RGB controls.

**The default base layer can be changed from layer 2.** This allows you to quickly switch between Mac and PC layouts, which comes in handy if you alternate between Mac and PC (either physically or via remote desktop/Citrix).

Feel free to edit the keymap yourself in QMK configurator, download the JSON, and follow along. 

---
# Flash the keymap onto the keyboard

**The file paths in this guide assume the Iris CE Rev. 1 keyboard!** You may need to modify them if you are using a different Iris keyboard and/or Iris revision.

1. Convert the JSON into a `keymap.c` file:

```bash
qmk json2c keebio_iris_ce_rev1_ibby.json > ~/qmk_firmware/keyboards/keebio/iris_ce/keymaps/ibby/keymap.c
```

2. Put the keyboard into [DFU mode](https://docs.qmk.fm/newbs_flashing#put-your-keyboard-into-dfu-bootloader-mode).

3. Flash the keyboard:

```bash
qmk flash -kb keebio/iris_ce/rev1 -km ibby
```

4. Clear the EEPROM. This is not strictly needed, but often fixes what appears to be non-working keymaps caused by persistent Via configurations, which interfere with the keymap you just flashed! Alternatively, disable Via in `~/qmk_firmware/keyboards/keebio/iris_ce/keymaps/ibby/rules.mk` (path assumes Iris CE keyboard).

---
# (Optional) Layer notifications in MacOS via Hammerspoon

Below are instructions to display an alert on screen when the default base layer is set to Mac or set to PC.

1. Copy the following into the `keymap.c` file, just below the `#include` directive(s):

```c
bool process_record_user(uint16_t keycode, keyrecord_t *record) {
	switch (keycode) {
	case DF(0):  // Mac
		if (record->event.pressed) {
			SEND_STRING(SS_TAP(X_F17));  // Send F17
		}
		return true;
	case DF(1):  // PC
		if (record->event.pressed) {
			SEND_STRING(SS_TAP(X_F18));  // Send F18
		}
		return true;
	default:
		return true;
	}
}
```

2. Compile, put into DFU mode, flash, and clear the EEPROM.

3. Add the following to Hammerspoon `init.lua` configuration file (in `~/.hammerspoon/init.lua`):

```lua
hs.hotkey.bind({}, 'f17', function()
    hs.alert.show("Mac layer on")
end)

hs.hotkey.bind({}, 'f18', function()
    hs.alert.show("PC layer on")
end)

```

Or, if you'd like to display a menubar icon in addition to an alert:

```lua
kb_layer_menu = hs.menubar.new()

label = hs.styledtext.new("LAYER ", { font = { size = 8 }, superscript = 0 })

code_mac = 0x100a82 -- Unicode code point for `command.square.fill` icon from SF Pro font

mac = hs.styledtext.new(utf8.char(code_mac), { font = { name = "SF Pro", size = 14 }, superscript = -1, obliqueness = 0.2 })
pc = hs.styledtext.new("PC", { font = { name = "Arial Black", size = 10 }, superscript = 1, obliqueness = 0.2 })

hs.hotkey.bind({}, 'f17', function()
    hs.alert.show("Mac layer on")
    if (kb_layer_menu) then kb_layer_menu:setTitle(label .. mac) end
end)

hs.hotkey.bind({}, 'f18', function()
    hs.alert.show("PC layer on")
    if (kb_layer_menu) then kb_layer_menu:setTitle(label .. pc) end
end)
```

---
# (Optional) Windows-like `Home` and `End` behaviour in MacOS

Below are instructions to tell MacOS to 

1. Copy the following and paste it into a text editor:

```
{
  "\UF729"  = moveToBeginningOfParagraph:; // home
  "\UF72B"  = moveToEndOfParagraph:; // end
  "$\UF729" = moveToBeginningOfParagraphAndModifySelection:; // shift+home
  "$\UF72B" = moveToEndOfParagraphAndModifySelection:; // shift+end
}
```

2. Save the file as `~/Library/KeyBindings/DefaultKeyBinding.dict`.

3. Restart any open applications for it to take effect in them, or simply reboot the machine.
